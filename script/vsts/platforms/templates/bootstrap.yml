steps:
  - bash: |
      if ["$OS" == "Windows_NT"]; then
          node script/vsts/windows-run.js script/bootstrap.cmd
      else
        script/bootstrap
      fi
    displayName: Bootstrap build environment
    env:
      GITHUB_TOKEN: $(GITHUB_TOKEN)
      OS: $(Agent.OS)
      CI: true
      CI_PROVIDER: VSTS
      ${{ if eq(variables['Agent.OS'], 'Windows_NT') }}:
        NPM_BIN_PATH: C:/hostedtoolcache/windows/node/12.13.1/x64/npm.cmd
        BUILD_ARCH: $(buildArch)
      ${{ if in(variables['Agent.OS'], 'Darwin', 'Linux') }}:
        NPM_BIN_PATH: /usr/local/bin/npm
      ${{ if in(variables['Agent.OS'], 'Darwin', 'Windows_NT') }}:
        npm_config_build_from_source: true
      ${{ if eq(variables['Agent.OS'], 'Linux') }}:
        CC: clang-5.0
        CXX: clang++-5.0
        npm_config_clang: 1
      condition: or(ne(variables['MainNodeModulesRestored'], 'true'), ne(variables['ScriptNodeModulesRestored'], 'true'), ne(variables['ApmNodeModulesRestored'], 'true'))
