parameters:
  - name: OS
    displayName: Operating System
    type: string
    values:
      - windows
      - linux
      - macos

steps:
  - task: Cache@2
    displayName: Cache node_modules
    inputs:
      key: 'npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | package.json, package-lock.json, script/vsts/platforms/templates/preparation.yml'
      restoreKeys: |
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | package.json, package-lock.json
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)"
      path: 'node_modules'
      cacheHitVar: MainNodeModulesRestored

  - task: Cache@2
    displayName: Cache script/node_modules
    inputs:
      key: 'npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | script/package.json, script/package-lock.json, script/vsts/platforms/templates/preparation.yml'
      restoreKeys: |
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | script/package.json, script/package-lock.json
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)"
      path: 'script/node_modules'
      cacheHitVar: ScriptNodeModulesRestored

  - task: Cache@2
    displayName: Cache apm/node_modules
    inputs:
      key: 'npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | apm/package.json, apm/package-lock.json, script/vsts/platforms/templates/preparation.yml'
      restoreKeys: |
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)" | apm/package.json, apm/package-lock.json
         npm | "$(Agent.OS)" | "$(BUILD_ARCH)"
      path: 'apm/node_modules'
      cacheHitVar: ApmNodeModulesRestored
